<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>
<script src="d3-scale-radial.js"></script>

<!-- visualization helpers -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://github.com/douglascrockford/JSON-js/blob/master/json2.js"></script>

<!-- font from Google API -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@350&display=swap" rel="stylesheet">

<!-- icons from Material Design -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<title>Musical Ties</title>


<!-- will move home to separate page at some point -->
<!-- <div style="display: flex; flex-direction: column; width: 100vw; margin: 0; padding: 0; max-width:100%; max-height:100%;">
  <b>Filter Playlist Attributes</b>
  <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="valence_min" class="form-label">valence</label>
        <p>min: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="valence_min">1.0</p>
        <p>max: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="valence_max">1.0</p>
      </div>
    </div>
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="valence_min" class="form-label">danceability</label>
        <p>min: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="danceability_min">1.0</p>
        <p>max: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="danceability_max">1.0</p>
      </div>
    </div>
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="valence_min" class="form-label">speechiness</label>
        <p>min: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="speechiness_min">1.0</p>
        <p>max: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="speechiness_max">1.0</p>
      </div>
    </div>
  </div>

  <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="valence_min" class="form-label">liveness</label>
        <p>min: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="liveness_min">1.0</p>
        <p>max: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="liveness_max">1.0</p>
      </div>
    </div>
    <div style="display: flex; flex-direction: row;">
      <div>
        <label for="valence_min" class="form-label">energy</label>
        <p>min: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="energy_min">1.0</p>
        <p>max: 0.0<input type="range" min="0" max="1" step=".1" class="slider" id="energy_max">1.0</p>
      </div>
    </div>
  </div>-->
  <!-- <div>
    <b>Sort By Attribute</b>
    <select class="form-select" id="sort">
      <option selected>none</option>
      <option>valence</option>
      <option>danceability</option>
      <option>speechiness</option>
      <option>liveness</option>
      <option>energy</option>
    </select>
  </div>
    
</div> 

<div style="display: flex; width: 100vw; height: 70vh; margin: 0; padding: 0; max-width:100%; max-height:100%;">
  <div style="display: flex; width: 100%; height: 100%;">
    <svg id='home' width="100%" height="100%"></svg>
    <svg id='playlist' width="100%" height="100%"></svg>
  </div>
</div>
<div style="display: flex; flex-direction: row; justify-content: center;">
  <h4>My New Playlist</h4>
</div>
<div style="display: flex; justify-content: center; width: 100vw; height: 100vh; margin: 0; padding: 0; max-width:100%; max-height:100%;">
  <div>
    (click a song to add/remove)
    
  </div>
  
</div> -->


<!-- I have this as position sticky rn to get it full width which i don't like but idk what else to do -->
<div class="row" style="height:100vh; width:100vw; top: 0;left: 0; right: 0;">
  <div class="col-1" id="menubar" style="width:auto">
    <span class="material-icons section-title" style="font-size: 40px; margin-right:-17px;">
      menu
    </span>
    <!-- <div>Do you know how to make this column as narrow as possible?</div> -->
  </div>
  <div class="col section-view" id="playlist-view">
    <!-- PLAYLIST EXPLORATION -->
  <div class="full-height-div">
    <div class="section-title">playlist exploration</div>
    <div> I wish i could make these circles show up *a little bit* higher</div>
    <div class="fill-remaining-space-div">
      <svg id='home' class="collapse show" width="100%" height="100%"></svg>
      <svg id='playlist' class="collpase" width="100%" height="100%"></svg>
    </div>
  </div>
  </div>
  <div class="col">
    <div class="row"><div class="col section-view section-view-right" id="filter-playlist"> 
      <!-- FILTER PLAYLIST -->
      <div class="section-title">filter playlist</div>
    </div></div>
    <div class="row"><div class="col section-view section-view-right section-view-bottom" id="sort-playlist"> 
      <!-- SORT PLAYLIST? (MAYBE) -->
      <div class="section-title">highlight playlist attribute?</div>
      <!-- THIS IS TEMPORARY SO CODE DOESNT BREAK-->
      <select class="form-select" id="sort">
        <option selected>none</option>
        <option>valence</option>
        <option>danceability</option>
        <option>speechiness</option>
        <option>liveness</option>
        <option>energy</option>
      </select>
    </div></div>
    <div class="row"><div class="col section-view section-view-right section-view-bottom" id="your-playlist"> 
      <div class="section-title">your playlist</div>
      <ul class="list-group" id="new_playlist"></ul>
    </div></div>
  </div>
</div>



<style>
:root {
  --background-dark: #17161B;
  --background-light: #302E38;
  --text-light: #ECEAF2; 
  --text-dark: #8F8B9A; 
}

body {
  background-color: var(--background-light);
  color: var(--text-light);
  font-family: 'Josefin Sans', sans-serif;
  font-weight: 300; 
}

.full-height-div{
  display: flex;
  flex-direction: column;
  height: 100%;
  align-content: stretch;
}

.fill-remaining-space-div{
  flex: 1 1 auto;
}

.section-view{
  background-color: var(--background-dark);
  margin: 10px; 
  border-radius: 5px; 
}
/* super jank way of doing the spacing but oh well */
.section-view-right{
  margin-left: 0px; 
}
.section-view-bottom{
  margin-top: 0px; 
}

.section-title{
  font-size: 30px;
  padding-top: 15px; 
  padding-left: 5px; 
}

div.tooltip {   
    position: absolute;           
    text-align: center;           
    width: 100px;                  
    height: 18px;                 
    padding: 2px;             
    font: 12px sans-serif;        
    background: lightsteelblue;   
    border: 0px;      
    border-radius: 10px;           
    pointer-events: none;
}
</style>

<script>

function removeSong(song) {
  song.parentElement.remove();
}

d3.json("https://raw.githubusercontent.com/6859-sp21/final-project-musical-ties/main/data/playListDataList.json").then(playlistData => {
d3.json("https://raw.githubusercontent.com/6859-sp21/final-project-musical-ties/main/data/trackData.json").then(trackData => {
  
  // COLORS AND VISUAL VARIABLES

  // colors of features
  var colors = ["#FFB0C2", "#FF6DB5", "#FF29D8", "#C02CE6", "#7C30FF"]; 
  // colors = colors.reverse(); 
  var colorsBright = ["#aaa8e6", "#c69de3", "#db8cdb", "#ffb3ab", "#ff9c5e", "#ffa83d"]; 

  // record colors 
  var darkerRecord = "#2d2b36";
  var lighterRecord = "#413f4a";
  
  var bubbleSize = 45; 
  var bubbleDistance = 15; 

  // order and values can be changed
  var features = [ "danceability", "energy", "valence", "liveness", "speechiness"]; 
  features = features.reverse(); 

  var tooltip = d3.select("body").append("div")   
        .attr("class", "tooltip")               
        .style("opacity", 0);

  function getPlaylistInfo(pID){
    for (p of playlistData) {
      if(p.id == pID){
        return p; 
      }
    }
  }
  
  
  // playlistData = playlistData.filter(playlist => !(playlist['name'] in ['mint', 'Lorem', 'Heart of Texas'])); 

  var sortselect = document.getElementById('sort');
  sortselect.onchange = function(){
    const feature = document.getElementById('sort').value;
    if (feature === 'none'){
      svgHome.selectAll("circle")
      .style("fill-opacity", .3 )
      .style("fill", '#69b3a2'); 
    } else {
      var fIndex = features.indexOf(feature); 
      svgHome.selectAll("circle")
      .style("fill-opacity", function(d) {
        return getAverage(d, feature); 
      })
      .style("fill", colors[fIndex]); 
    }
    
  };

  var examplePlaylist;

  /////////////////////////////////
  // HOME SCREEN - WILL MOVE LATER
  /////////////////////////////////

  // append the svg object to the body of the page
  var svgHome = d3.select("svg#home")
  var widthHome = $("svg#home").width()
  var heightHome = $("svg#home").height()

  function getBubbleData() {
    let data = [];
    for (p of playlistData) {
      if(!(['mint', 'Lorem', 'Heart Of Texas', "Today's Top Hits", 'POLLEN', 'Beast Mode Hip-Hop', 'RADAR Country', 'Rock This', "Chillin' on a Dirt Road", "Ultimate Indie", "my life is a movie", "Breakout Country", "Pop Rising", "Teen Beats",  "I Love My '00s R&B"].includes(p.name))){
        let bubble = {};
        bubble.name = p['id'];
        data.push(bubble);
      }
    }
    return data;
  }
   
  var bubbleData = getBubbleData();
  console.log(bubbleData)
  console.log(trackData)

  // input: playlist is entire playlist dictionary
  function getAverage(playlist, feature){
      return getAverageFromID(playlist.name, feature); 
  }

  // inpust playlistID is just the
  function getAverageFromID(playlistID, feature){
    var sum = 0; 
    var total = 0; 
    for(p of playlistData ){
      if(p.id == playlistID){
        for(song of p['track_ids']){
          sum += trackData[song]['features'][feature]; 
        }
        total = p['track_ids'].length; 
        return sum / total; 
      }
    }
  }

  // returns an array of the average features
  function getAverageFeatures(playlistID){
    var feats = [];
    for(var i = 0; i < features.length; i++){
      feats.push(getAverageFromID(playlistID, features[i]));
    }
    return feats; 
  }

  function colorBubbles(feature){
    var fIndex = features.indexOf(feature); 
    currentColor = colors[fIndex];

    svgHome.selectAll("circle")
    .style("fill-opacity", function(d) {
      return getAverage(d, feature); 
    }).style("fill", currentColor); 
  }

  var currentColor = "#ffffff";
  var currentOpacity = 0.3;

  // Initialize the circle: all located at the center of the svg area
  function drawBubbles() {
    var node = svgHome.selectAll("g")
      .data(bubbleData)
      .join(
            enter  => enter.append('g'),
            update => update,
            exit   => exit.remove()
          )


    var myx = d3.scaleLinear()
    .range([0, 2 * Math.PI])
    .domain([0, 1]);

    var myy = d3.scaleLinear()
    .range([10, bubbleSize])
    .domain([0, 5]);

    // draws the black record
    node
      .append("g")
      .selectAll("g")
      .data([5, 4, 3, 2, 1, 0])
      .enter().append("circle")
      .classed('disk', true)
      .style("fill", function(d) { if(d % 2 == 0){ return darkerRecord} return lighterRecord })
      .attr('r', function(d) {return myy(d)})

    // draws a transparent circle that is meant for detection
    node
      .append("g")
      .selectAll("g")
      .data(function(d) {return [d]})
      .enter().append("circle")
      .classed('detect', true)
      .style("opacity", "0")
      .attr('r', bubbleSize)
      .on("click", function(event, d){
          // svgHome.selectAll('circle').data(bubbleData).exit().remove();  
          examplePlaylist = playlistData.filter(p => p.id === d.name)[0];
          bubbleData = [];
          drawBubbles();
          drawPlaylist();
      })
      .on("mouseover", function(d, i){
        console.log("circle"); 
        // // TODO figure out a better way to highlight
        // // d3.select(this).attr("stroke", function(d){ return d3.rgb("#363636").brighter(5) });
        //   // .attr("fill", function(d){ return d3.rgb("#69b3a2").brighter(5) }); 
        // // console.log(d);
        // console.log("i am being detected"); 
        // console.log(event.pageX); 
        // tooltip.transition().duration(200).style("opacity", .9);      

        // console.log(d3.selectAll("circle")[0][i].attr("cx")); 
        // console.log(document.getElementById("home").offsetLeft); 
        // console.log((parseInt(d3.select(this).attr("cx")) + document.getElementById("home").offsetLeft) ); 

        // tooltip.html("WHAT THE FUCK BITCH")  
        //     .style("left", (parseInt(d3.select(this).attr("cx")) + document.getElementById("home").offsetLeft) + "px")     
        //     .style("top", (parseInt(d3.select(this).attr("cy")) + document.getElementById("home").offsetTop) + "px"); 
      })
      // .on("mouseout", function(event, d){
      //   var c = "t" + d.name; 
      //   node.select('text.' + c).remove();
      // }); 

    // draws the colors on the record
    node
    .append('g')
    .selectAll('path')
    .data(function(d) {return getAverageFeatures(d.name)}) // map to index, and maybe you can calculate the feature list here and then go from there 
    .enter().append("path")
    .style("fill", function(d, i) { return colors[i] })
      .attr("d", d3.arc() 
          .innerRadius(function(d, i) { return myy(i); })
          .outerRadius(function(d, i) { return myy(i + 1); })
          .startAngle(function(d) { return 0 })
          .endAngle(function(d) { return myx(d); })
          .padAngle(0.005)
          .padRadius(innerRadius)
          )
        .on('mouseover', function(d, i){
          console.log("bar"); 
        }); 

    // playlist title
    node
      .append("g")
      .selectAll("g")
      .data(function(d) {return [d]})
      .enter().append("text")
      .classed('playlistTitle', true)
      .text(function(d) { console.log(d); return getPlaylistInfo(d.name).name})
      .style("fill", "white"); 
      

   // Features of the forces applied to the nodes:
    var simulation = d3.forceSimulation()
      .force("center", d3.forceCenter().x(widthHome / 2).y(heightHome / 2)) // Attraction to the center of the svg area
      .force("charge", d3.forceManyBody().strength(0.5)) // Nodes are attracted one each other of value is > 0
      .force("collide", d3.forceCollide().strength(.1).radius(bubbleSize + bubbleDistance).iterations(1)) // Force that avoids circle overlapping

    // Apply these forces to the nodes and update their positions.
    // Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
    simulation
      .nodes(bubbleData)
      .on("tick", function(d){
        node.selectAll('g')
          .attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")"});
        node.selectAll('text')
          .attr("transform", function(d) {return "translate(" + 0 + "," + (-50) + ")"});
      });
  }
  drawBubbles(bubbleData);

  //how do i make this cleaner?
  d3.select('#valence_min').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'valence') >= this.value);

    drawBubbles();
  });

  d3.select('#danceability_min').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'danceability') >= this.value);
    drawBubbles();
  });

  d3.select('#speechiness_min').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'speechiness') >= this.value);
    drawBubbles();
  });

  d3.select('#liveness_min').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'liveness') >= this.value);
    drawBubbles();
  });

  d3.select('#energy_min').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'energy') >= this.value);
    drawBubbles();
  });

  d3.select('#valence_max').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'valence') <= this.value);
    drawBubbles();
  });

  d3.select('#danceability_max').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'danceability') <= this.value);
    drawBubbles();
  });

  d3.select('#speechiness_max').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'speechiness') <= this.value);
    drawBubbles();
  });

  d3.select('#liveness_max').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'liveness') <= this.value);
    drawBubbles();
  });

  d3.select('#energy_max').on("input", function() {
    svgHome.selectAll('circle').data(bubbleData).exit().remove(); 
    bubbleData = getBubbleData().filter(b => getAverage(b, 'energy') <= this.value);
    drawBubbles();
  });
  
  // TODO width and height will probs need to be different when not in full screen viewing
  var svg = d3.select("svg#playlist").attr("preserveAspectRatio", "xMinYMin meet"),
    width = $("svg#playlist").width(),
    height = $("svg#playlist").height(),
    innerRadius = Math.min(width, height) / 6,
    outerRadius = Math.min(width, height) / 2,
    g = svg.append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")"); 

  var y = d3.scaleRadial()
    .range([innerRadius, outerRadius])
    .domain([0, 5]);

  function getBrighterByFeature(feature){
    var ind = features.indexOf(feature); 
    return colorsBright[ind];
  }

  function getDarkerByFeature(feature){
    var ind = features.indexOf(feature); 
    return colors[ind];
  }

  function getBrighterByColor(color){
    for(var i = 0; i < colors.length; i++){
      if(d3.rgb(colors[i]) == color){
        return colorsBright[i]; 
      }
    }
  }

  function getDarkerByColor(color){
    for(var i = 0; i < colorsBright.length; i++){
      if(d3.rgb(colorsBright[i]) == color){
        return colors[i]; 
      }
    }
  }

  var selectedSong = ""; 

  function drawPlaylist(){
    svg.selectAll('path').data(examplePlaylist['track_ids']).exit().remove(); 
    drawPlaylistLegend();
    updatePlaylistDisplayInfo([examplePlaylist["name"]]);

    var x = d3.scaleBand()
    .range([0, 2 * Math.PI])
    .align(0)
    .domain(examplePlaylist["track_ids"]);

    features.forEach((feature, i) => {
      g.append('g')
        .selectAll('path')
        .data(examplePlaylist['track_ids'])
        .join(
          enter => enter.append('path'),
          update => update,
          exit   => exit.remove()
        )
        .classed(feature, true)
        .style("fill", colors[i])
          .attr("d", d3.arc() 
              .innerRadius(function(d) { return y(getFeatureStartPos(d, i)); })
              .outerRadius(function(d) { return y(getFeatureEndPos(d, i)); })
              .startAngle(function(d) { return x(d); })
              .endAngle(function(d) { return x(d) + x.bandwidth(); })
              .padAngle(0.005)
              .padRadius(innerRadius)
              )
      }); 

      g.append('g')
        .selectAll('path')
        .data(examplePlaylist['track_ids'])
        .join(
          enter => enter.append('path'),
          update => update,
          exit   => exit.remove()
        )
        .attr("opacity","0")
        .attr("d", d3.arc() 
          .innerRadius(function(d) { return y(0); })
          .outerRadius(function(d) { return y(5); }) // this val could be improved but whatever for now
          .startAngle(function(d) { return x(d); })
          .endAngle(function(d) { return x(d) + x.bandwidth(); })
          .padAngle(0.01)
          .padRadius(innerRadius)
          )
        .on("mouseenter", function(event, d, i){
          displaySongInfoPlaylist(d, i); 
          var selectedSong = d; 
          svg.selectAll("path")
            .filter(d => d == selectedSong)
            .style("fill", function(d){ return getBrighterByColor(this.style.fill)})
        })
        .on("mouseout", function(event, d, i){
          // TODO i'm not sure this will work when we scale up
          updatePlaylistDisplayInfo([examplePlaylist["name"]]);
          var selectedSong = d;
          svg.selectAll("path")
            .filter(d => d == selectedSong)
            .style("fill", function(d){ return getDarkerByColor(this.style.fill)})
        })
        .on("click", function(event, d, i){
          let playlist = document.getElementById('new_playlist');
          let song = document.createElement('li');
          song.className = "list-group-item";
          song.id = d;
          song.innerHTML = `${trackData[d].title}<button type="button" class="btn btn-secondary" onclick="removeSong(this)"><span class="material-icons">delete</span></button>`;
          playlist.appendChild(song);
        })


  }



  function displaySongInfoPlaylist(songID){
    var songInfo = trackData[songID]; 
    var songFeatures = [songInfo['title']]; 
    for(var i = 0; i < features.length; i++){
      let info = "" + features[i] + " " + songInfo['features'][features[i]]; 
      songFeatures.push(info); 
    }
    updatePlaylistDisplayInfo(songFeatures); 
  }

  function drawPlaylistLegend(){
    g.selectAll('rect.legend').data(features).join(
      enter => enter.append("rect"),
      update => update,
      exit   => exit.remove()
    )
    .style('cursor', 'pointer')
    .style("fill", function(d) {return colors[features.indexOf(d)]})
    .attr("stroke-width", 2)
    .attr("fill-opacity", .4)
    .attr("width", 18)
    .attr("height", 18)
    .classed('legend', true)
    .attr("opacity", "1")
    .text(d => d)
    .attr("transform", (d, i) => `translate(-20,${(i * 20 + 5)})`)
    .on("mouseenter", function(event, d){
      var objClass = "path." + d; 
      svg.selectAll(objClass).style("fill", getBrighterByFeature(d))
    })
    .on("mouseout", function(event, d){
      var objClass = "path." + d; 
      svg.selectAll(objClass).style("fill", getDarkerByFeature(d))
    })
    .on("click", function(event, d){
      var objClass = "path." + d; 
      svg.selectAll('path').data(examplePlaylist['track_ids']).exit().remove(); 
      examplePlaylist['track_ids'] =  sortByFeature(examplePlaylist['track_ids'], d); 
      // svg.selectAll(objClass).style("fill", getBrighter(this.style.fill))
      drawPlaylist(); 
      svg.selectAll(objClass).style("fill", getBrighterByFeature(d)); 

      colorBubbles(d); 
    })
  }

  function updatePlaylistDisplayInfo(title){
    if(title.length == 1){
      for(var i = 0; i < features.length; i++){
        title.push(features[i]); 
      }
    }

    // middle of playlist text
    g.selectAll("text.playlistInfo").data(title).join(
      enter => enter.append("text"),
      update => update,
      exit   => exit.remove()
    )
    .style("fill", "black")
    .attr("stroke-width", 2)
    .attr("fill-opacity", .4)
    .classed('playlistInfo', true)
    .text(d => d)
    .attr("transform", (d, i) => `translate(0,${(i * 20)})`); 
  }

  function sortByFeature(songs, feature){
    // TODO might be better to not sort the original array? how do you get back to original config... hmm 
    svg.selectAll('path').data(examplePlaylist['track_ids']).exit().remove();
    
    songs.sort(function(a, b) {
      return trackData[a]["features"][feature] - trackData[b]["features"][feature]; 
    }); 

    x = d3.scaleBand()
      .range([0, 2 * Math.PI])
      .align(0)
      .domain(songs);
    return songs; 
  }

  function getFeatureStartPos(songId, featureIndex){
    // console.log('start')
    // console.log(trackData[songId])
    var total = 0;  
    for(var i = 0; i < featureIndex; i++){
      total += trackData[songId]["features"][features[i]];
    }
    return total; 
  }

  function getFeatureEndPos(songId, featureIndex){
    // console.log('end')
    // console.log(songId);
    var total = getFeatureStartPos(songId, featureIndex);  
    total += trackData[songId]["features"][features[featureIndex]];
    return total; 
  }

}); 
  
}); 


</script>